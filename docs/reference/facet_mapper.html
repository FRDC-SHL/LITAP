<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate landform facets using LSM logic — facet_mapper • LITAP</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate landform facets using LSM logic — facet_mapper"><meta property="og:description" content="This function takes backup data frame output from flow_mapper() and
form_mapper() calculates fuzzy attributes (among other metrics).  Based on
FacetMapR by R. A. (Bob) MacMillan, LandMapper Environmental Solutions."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LITAP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/steffilazerte/LITAP" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate landform facets using LSM logic</h1>
    <small class="dont-index">Source: <a href="https://github.com/FRDC-SHL/LITAP/blob/HEAD/R/facet_mapper.R" class="external-link"><code>R/facet_mapper.R</code></a></small>
    <div class="hidden name"><code>facet_mapper.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function takes backup data frame output from <code><a href="flow_mapper.html">flow_mapper()</a></code> and
<code><a href="form_mapper.html">form_mapper()</a></code> calculates fuzzy attributes (among other metrics).  Based on
FacetMapR by R. A. (Bob) MacMillan, LandMapper Environmental Solutions.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">facet_mapper</span><span class="op">(</span>
  <span class="va">folder</span>,
  arule <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">crule</span>,
  edge_row <span class="op">=</span> <span class="cn">NULL</span>,
  edge_col <span class="op">=</span> <span class="cn">NULL</span>,
  procedure <span class="op">=</span> <span class="st">"lsm"</span>,
  zone <span class="op">=</span> <span class="cn">NULL</span>,
  clean <span class="op">=</span> <span class="cn">FALSE</span>,
  resume <span class="op">=</span> <span class="cn">NULL</span>,
  log <span class="op">=</span> <span class="cn">TRUE</span>,
  verbose <span class="op">=</span> <span class="cn">FALSE</span>,
  quiet <span class="op">=</span> <span class="cn">FALSE</span>,
  debug <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>folder</dt>
<dd><p>Character. Location of <code><a href="flow_mapper.html">flow_mapper()</a></code> output</p></dd>
<dt>arule</dt>
<dd><p>Character. Location of ARULE file. If NULL, A Rules are derived
from the dem file (see Details).</p></dd>
<dt>crule</dt>
<dd><p>Character. Location of CRULE file</p></dd>
<dt>edge_row</dt>
<dd><p>Numeric. Number of rows to remove around the edge of the dem
before deriving the A Rules. Default (NULL) results in removing 5% of the
rows per side (total of 10%).</p></dd>
<dt>edge_col</dt>
<dd><p>Numeric. Number of cols to remove around the edge of the dem
before deriving the A Rules. Default (NULL) results in removing 5% of the
cols per side (total of 10%).</p></dd>
<dt>procedure</dt>
<dd><p>Character. Which procedure to use. One of <code>lsm</code>
(Original LandMapR program) or <code>bc_pem</code> (newer BC-PEM Direct-to-Site-Series
program).</p></dd>
<dt>zone</dt>
<dd><p>file. If <code>procedure = "bc_pem"</code>, zones must either be defined for
each seqno in the form dem file, OR must be provided as an index file
here. With a <code>zone</code> defined for each <code>seqno</code>. <code>zone</code> file can be either dem
(.dem), Excel (.xlsx, .xls), or text (.txt, .csv, .dat)</p></dd>
<dt>clean</dt>
<dd><p>Logical. Remove all output files from previous runs in this
folder?</p></dd>
<dt>resume</dt>
<dd><p>Character. From which stage should the run be resumed? (see</p></dd>
<dt>log</dt>
<dd><p>Logical. Create log file recording progress?</p></dd>
<dt>verbose</dt>
<dd><p>Logical. Output extra progress messages.</p></dd>
<dt>quiet</dt>
<dd><p>Logical. Suppress all messages.</p></dd>
<dt>debug</dt>
<dd><p>Logical. If TRUE, output files contain intermediate columns
useful for debugging (e.g., 'buffer', 'seqno_buffer', etc.) Default FALSE.</p></dd>
</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Based on the technique described in Li et al. 2011, if no <code>arule</code> file is
provided, the ARULE cutoffs are calculated from the <code><a href="form_mapper.html">form_mapper()</a></code> dem
files. These A Rules are saved as <code>afile_derived.csv</code> in the <code>folder</code>
provided. The topographic derivative percentiles are stored to
<code>topographic_derivatives.csv</code>, also in the <code>folder</code>.</p>
<p>Procedure <code>lsm</code> refers to the landform segmentation model (LSM) offered in
the original LandMapR. Procedure <code>bc_pem</code> refers to calculating variables
required for the British Columbia Predictive Ecosystem Mapping
Direct-to-Site-Series program (BC-PEM DSS).</p>
<p>For resuming  a run, <code>resume</code> must be
one of the following:</p><ul><li><p>attributes</p></li>
<li><p>classes</p></li>
</ul><p>@references
Sheng Li, David A. Lobb, Brian G. McConkey, R. A. MacMillan, Alan Moulin,
and Walter R. Fraser. 2011. Extracting topographic characteristics of landforms
typical of Canadian agricultural landscapes for agri-environmental modeling.
I. Methodology. Canadian Journal of Soil Science 91(2), 251-266.
doi: <a href="https://doi.org/10.4141/CJSS10080" class="external-link">10.4141/CJSS10080</a>
.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="co"># First need to run flow_mapper()</span></span>
<span class="r-in"><span class="fu"><a href="flow_mapper.html">flow_mapper</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"testELEV.dbf"</span>, package <span class="op">=</span> <span class="st">"LITAP"</span><span class="op">)</span>,</span>
<span class="r-in">           out_folder <span class="op">=</span> <span class="st">"./testELEV/"</span>, nrow <span class="op">=</span> <span class="fl">90</span>, ncol <span class="op">=</span> <span class="fl">90</span>, grid <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING DIRECTIONS</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING WATERSHEDS</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> REMOVING INITIAL PITS</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING POND (GLOBAL) WATERSHEDS</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING FILL PATTERNS</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> INVERTING DEM</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING INVERTED DIRECTIONS</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING INVERTED WATERSHEDS</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> REMOVING INVERTED PITS</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CREATING REPORT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Run took: 0.25 min</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># And form_mapper()</span></span>
<span class="r-in"><span class="fu"><a href="form_mapper.html">form_mapper</a></span><span class="op">(</span>folder <span class="op">=</span> <span class="st">"./testELEV/"</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> SETUP</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING FORM</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING WETNESS INDICES</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING RELIEF DERIVITIVES</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING SLOPE LENGTH</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> MERGING FLOW AND FORM DATA FOR `ALL_POINTS` FILE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Run took: 0.11 min</span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">crule</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"crule.dbf"</span>, package <span class="op">=</span> <span class="st">"LITAP"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Run facet_mapper() - Derive A Rules</span></span>
<span class="r-in"><span class="fu">facet_mapper</span><span class="op">(</span>folder <span class="op">=</span> <span class="st">"./testELEV/"</span>, arule <span class="op">=</span> <span class="cn">NULL</span>, crule <span class="op">=</span> <span class="va">crule</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using buffer of 4 rows ('edge_row') and 4 cols ('edge_col') per side</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Formatting arule file</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   - Renaming 'slope' to 'slope_pct'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Formatting crule file</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING FUZZY ATTRIBUTES</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING CLASSES</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Run took: 0 min</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Derive A Rules, omitting rows and cols from the calculation</span></span>
<span class="r-in"><span class="fu">facet_mapper</span><span class="op">(</span>folder <span class="op">=</span> <span class="st">"./testELEV/"</span>, arule <span class="op">=</span> <span class="cn">NULL</span>, crule <span class="op">=</span> <span class="va">crule</span>,</span>
<span class="r-in">             edge_row <span class="op">=</span> <span class="fl">3</span>, edge_col <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using buffer of 3 rows ('edge_row') and 1 cols ('edge_col') per side</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Formatting arule file</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   - Renaming 'slope' to 'slope_pct'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Formatting crule file</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING FUZZY ATTRIBUTES</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING CLASSES</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Run took: 0 min</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Run facet_mapper() - supply A Rules</span></span>
<span class="r-in"><span class="va">arule</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"arule.dbf"</span>, package <span class="op">=</span> <span class="st">"LITAP"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">crule</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"crule.dbf"</span>, package <span class="op">=</span> <span class="st">"LITAP"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">facet_mapper</span><span class="op">(</span>folder <span class="op">=</span> <span class="st">"./testELEV/"</span>, arule <span class="op">=</span> <span class="va">arule</span>, crule <span class="op">=</span> <span class="va">crule</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Formatting arule file</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   - Renaming 'slope' to 'slope_pct'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Formatting crule file</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING FUZZY ATTRIBUTES</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CALCULATING CLASSES</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Run took: 0.01 min</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Clean up (remove all output)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="st">"./testELEV/"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Steffi LaZerte, Sheng Li, Agriculture and Agri-Food Canada.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

